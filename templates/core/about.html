{% extends 'base.html' %}

{% block title %}О нас - {{ block.super }}{% endblock %}

{% block content %}
{% load static %}
    <!-- Секция О нас -->
    <section class="py-12">
      <div class="container mx-auto px-4">
        <!-- Верхняя сетка -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 items-stretch mb-8">
          <!-- О нас + Лого -->
          <div class="md:col-span-2">
            <div class="bg-white rounded-lg shadow-lg p-8 h-full flex flex-col md:flex-row md:items-center">
              <div class="md:w-2/3">
                <h2 class="text-3xl font-bold text-gray-800 mb-4">О нас</h2>
                <div class="prose max-w-none text-gray-700">
                  {{ company_info.about_us|safe }}
                </div>
              </div>
              <div class="md:w-1/3 mt-6 md:mt-0 md:flex md:items-center md:justify-center">
                <div class="hidden md:flex items-center justify-center w-full h-full">
                  {% if company_info.logo %}
                    <img src="/media/{{ company_info.logo }}" alt="{{ company_info.company_name }} logo"
                         class="max-w-[180px] w-full h-auto object-contain">
                  {% endif %}
                </div>
              </div>
            </div>
          </div>

          <!-- Цели (справа) -->
          <div class="h-full">
            <div class="bg-white rounded-lg shadow-lg p-6 h-full flex flex-col">
              <div class="space-y-4 mt-2 flex-1">
                {% for item in goals %}
                  <div class="p-4 h-full flex flex-col">
                    <div class="flex items-start">
                      <div class="w-10 h-10 bg-blue-50 text-blue-600 rounded-full flex items-center justify-center text-lg shrink-0">
                        <i class="fa-solid fa-bullseye"></i>
                      </div>
                      <h4 class="ml-4 text-lg font-medium text-gray-800">{{ item.title }}</h4>
                    </div>
                    {% if item.lines %}
                      <ul class="list-disc list-inside text-gray-700 mt-3 space-y-1">
                        {% for line in item.lines %}
                          <li>{{ line }}</li>
                        {% endfor %}
                      </ul>
                    {% else %}
                      <div class="prose text-gray-700 mt-3">{{ item.text|linebreaksbr }}</div>
                    {% endif %}
                  </div>
                {% endfor %}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Нижняя сетка: 3 колонки (1 - Задачи, 2 - Стратегия, 3 - Две картинки) -->
      <div class="container mx-auto px-4">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 items-stretch">
          <!-- Колонка 1: Задачи -->
          <div class="col-span-1">
            <div class="bg-white rounded-lg shadow-sm p-6 h-full flex flex-col overflow-hidden" data-aos="fade-up">
              <div class="space-y-4 flex-1 overflow-auto" style="scrollbar-width: none;">
                {% for item in tasks %}
                <div class="p-4">
                  <div class="flex items-start">
                    <div class="w-10 h-10 bg-green-50 text-green-600 rounded-full flex items-center justify-center text-lg shrink-0">
                      <i class="{% if item.icon %}{{ item.icon }}{% else %}fa-solid fa-list-check{% endif %}"></i>
                    </div>
                    <h4 class="ml-3 text-lg font-medium text-gray-800">{{ item.title }}</h4>
                  </div>
                  {% if item.lines %}
                  <ul class="list-disc list-inside text-gray-700 mt-3 space-y-1">
                    {% for line in item.lines %}
                      <li>{{ line }}</li>
                    {% endfor %}
                  </ul>
                  {% else %}
                  <div class="prose text-gray-700 mt-3">{{ item.text|linebreaksbr }}</div>
                  {% endif %}
                </div>
                {% endfor %}
              </div>
            </div>
          </div>

          <!-- Колонка 2-3 (объединённые): Стратегия + 2 фото-->
          <div class="col-span-1 md:col-span-2">
            <div class="bg-white rounded-lg shadow-sm p-6 h-full flex overflow-hidden flex-col md:flex-row" data-aos="fade-up">

              <!-- Левый блок: текст стратегии -->
              <!-- Стратегия (в одной рамке, с иконкой, корректным выводом текста) -->
                <div class="p-6 flex flex-col h-full md:w-1/2" data-aos="fade-up">
                    <!-- Заголовок + иконка -->
                    <div class="flex items-start mb-4">
                        <div class="w-12 h-12 bg-purple-50 text-purple-600 rounded-full flex items-center justify-center text-xl shrink-0">
                            <i class="fa-solid fa-chess-knight"></i>
                        </div>
                        <h3 class="ml-4 text-xl font-semibold text-gray-800">
                            {{ strategy.0.title }}
                        </h3>
                    </div>
                    <!-- Текст стратегии -->
                    <div class="text-gray-700 leading-relaxed prose max-w-none">
                        {{ strategy.0.text|linebreaksbr }}
                    </div>
                </div>
              <!-- Правый блок: две фотографии (стек сверху вниз) -->
              <div class="hidden md:flex md:flex-col md:w-1/2 gap-4 pl-4 items-center justify-start">
                <!-- Подставьте реальные имена файлов в /media/about/ -->
                <img src="/media/about/photo1.jpg" alt="Фото 1" class="w-full h-1/3 object-cover rounded-md shadow-sm pt-10" />
                <img src="/media/about/photo2.jpg" alt="Фото 2" class="w-full h-1/3 object-cover rounded-md shadow-sm" />
              </div>
              <!-- Мобильный вариант: фотографии под текстом -->
              <div class="flex md:hidden mt-4 w-full gap-4">
                <img src="/media/about/photo1.jpg" alt="Фото 1" class="w-1/2 h-36 object-cover rounded-md shadow-sm" />
                <img src="/media/about/photo2.jpg" alt="Фото 2" class="w-1/2 h-36 object-cover rounded-md shadow-sm" />
              </div>
            </div>
          </div>
        </div>
      </div>
</section>

<!-- Секция Лицнзии -->
<section class="py-12">
  <div class="container mx-auto px-4">
    <div class="text-center mb-8" data-aos="fade-up">
      <h2 class="text-3xl md:text-4xl font-bold text-gray-800">Наши Лицензии</h2>
      <p class="text-gray-600 max-w-2xl mx-auto mt-3">
        Государственные лицензии первой категории на выполнение проектно-изыскательской деятельности, строительно-монтажных работ и эксплуатацию электрических сетей и подстанции всех типов.
      </p>
    </div>
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 mt-8">
      {% for license in licenses %}
      <div class="bg-white rounded-lg shadow-sm p-4 flex flex-col items-stretch text-center" data-aos="fade-up">
        <!-- Заголовок -->
        <h3 class="text-lg font-semibold text-gray-800 mb-1">{{ license.description }}</h3>
        <p class="text-sm text-gray-500 mb-4">{{ license.category }}</p>
        <!-- Изображение -->
        <button type="button" class="group overflow-hidden rounded-md focus:outline-none" onclick="openLicenseModal('{{ license.image.url }}')">
          <img
            src="{{ license.image.url }}"
            alt="{{ license.title }}"
            loading="lazy"
            class="w-full h-64 md:h-96 object-contain bg-gray-50 rounded-md shadow-sm transform transition-transform duration-200 group-hover:scale-105"
          />
        </button>
      </div>
      {% empty %}
      <p class="text-gray-600">Лицензии не добавлены.</p>
      {% endfor %}
    </div>
  </div>
</section>


<!-- Секция Сертификаты -->
<section class="py-12">
  <div class="container mx-auto px-4">
    <div class="text-center mb-8" data-aos="fade-up">
      <h2 class="text-3xl md:text-4xl font-bold text-gray-800">Сертификаты</h2>
      <p class="text-gray-600 max-w-2xl mx-auto mt-3">
        ТОО «ТЭСС-Проект» прошло сертификацию своей деятельности на соответствие  с Системой менеджмента качества, по результатам которого были получены сертификаты соответствия:
      </p>
    </div>
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 mt-8">
      {% for certificate in certificates %}
      <div class="bg-white rounded-lg shadow-sm p-4 flex flex-col items-stretch text-center" data-aos="fade-up">
        <!-- Заголовок -->
        <h3 class="text-lg font-semibold text-gray-800 mb-1">{{ certificate.description }}</h3>
        <p class="text-sm text-gray-500 mb-4">{{ certificate.category }}</p>
        <!-- Изображение -->
        <button type="button" class="group overflow-hidden rounded-md focus:outline-none" onclick="openLicenseModal('{{ certificate.image.url }}')">
          <img
            src="{{ certificate.image.url }}"
            alt="{{ certificate.title }}"
            loading="lazy"
            class="w-full h-64 md:h-96 object-contain bg-gray-50 rounded-md shadow-sm transform transition-transform duration-200 group-hover:scale-105"
          />
        </button>
      </div>
      {% empty %}
      <p class="text-gray-600">Сертификаты не добавлены.</p>
      {% endfor %}
    </div>
  </div>
</section>
    
    
<!-- Секция Награды и Отзывы -->
<section class="py-12">
  <div class="text-center mb-8" data-aos="fade-up">
      <h2 class="text-3xl md:text-4xl font-bold text-gray-800">Награды и отзывы</h2>
      <p class="text-gray-600 max-w-2xl mx-auto mt-3">
        Результаты нашей работы подтверждены профессиональными наградами и отзывами клиентов.
      </p>
  </div> 
  <div class="container mx-auto px-4">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">

      <!-- Награды -->
      <div>
        <h2 class="text-2xl font-semibold mb-4 text-center">Награды</h2>
        {% include "partials/slider.html" with items=awards %}
      </div>

      <!-- Отзывы -->
      <div>
        <h2 class="text-2xl font-semibold mb-4 text-center">Отзывы</h2>
        {% include "partials/slider.html" with items=testimonials %}
      </div>

    </div>
  </div>
</section> 
    
<!-- Модал -->
<div id="imageModal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/70 px-4 py-6">
  <button id="imageModalClose" class="absolute top-4 right-4 text-white text-2xl p-2 rounded-md hover:bg-white/10 focus:outline-none" aria-label="Закрыть">&times;</button>

  <div class="max-w-full max-h-full flex items-center justify-center">
    <img id="imageModalImg" src="" alt="Preview" class="max-h-[90vh] max-w-full object-contain rounded-md shadow-lg" />
  </div>
</div>
    
<script>
document.querySelectorAll('[data-slider]').forEach(slider => {
  const track = slider.querySelector('.slider-track');
  const items = track.children.length;
  const prev = slider.querySelector('.slider-prev');
  const next = slider.querySelector('.slider-next');

  let index = 0;

  function update() {
    track.style.transform = `translateX(-${index * 100}%)`;
  }

  prev.addEventListener('click', () => {
    index = Math.max(index - 1, 0);
    update();
  });

  next.addEventListener('click', () => {
    index = Math.min(index + 1, items - 1);
    update();
  });

  // SWIPE
  let startX = 0;
  slider.addEventListener('touchstart', e => {
    startX = e.touches[0].clientX;
  });

  slider.addEventListener('touchend', e => {
    const endX = e.changedTouches[0].clientX;
    if (startX - endX > 50 && index < items - 1) index++;
    if (endX - startX > 50 && index > 0) index--;
    update();
  });
});
</script>
<script>
  // Открыть модалку
  function openLicenseModal(imageUrl) {
    const modal = document.getElementById('imageModal');
    const img = document.getElementById('imageModalImg');

    img.src = imageUrl;
    modal.classList.remove('hidden');
    
    document.documentElement.style.overflow = 'hidden';
  }

  // Закрыть модалку
  function closeLicenseModal() {
    const modal = document.getElementById('imageModal');
    const img = document.getElementById('imageModalImg');

    modal.classList.add('hidden');
    img.src = '';
    document.documentElement.style.overflow = '';
  }

  // Привязка кнопки и закрытие по клику вне картинки и по ESC
  document.getElementById('imageModalClose').addEventListener('click', closeLicenseModal);

  document.getElementById('imageModal').addEventListener('click', function(e) {
    const img = document.getElementById('imageModalImg');
    if (!img.contains(e.target)) {
      closeLicenseModal();
    }
  });

  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') closeLicenseModal();
  });
</script>
{% endblock %}